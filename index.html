<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indicore AI - Multilingual Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient-start: #7c4dff; /* Deeper, richer purple */
            --primary-gradient-end: #5b3ac2; /* Complementary dark purple */
            --primary-color: #7c4dff;
            --accent-color: #5b3ac2;
            --background-light: #f8f9fa; /* Slightly lighter background */
            --background-card: #ffffff;
            --text-dark: #212529;
            --text-medium: #6c757d;
            --border-light: #e9ecef; /* Softer border */
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --shadow-strong: rgba(0, 0, 0, 0.2);
            --success-color: #28a745;
            --error-color: #dc3545;

            /* RGB values for dynamic shadows */
            --primary-color-rgb: 124, 77, 255;
            --error-color-rgb: 220, 53, 69;
            --success-color-rgb: 40, 167, 69;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-dark);
            overflow: hidden; /* Prevent body scroll if content overflows */
        }

        .chat-container {
            background: var(--background-card);
            border-radius: 28px; /* Slightly larger border-radius */
            box-shadow: 0 20px 50px var(--shadow-strong); /* More prominent shadow */
            width: 100%;
            max-width: 900px; /* Slightly wider */
            height: 700px; /* Slightly taller */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: scale(0.98); /* Initial subtle scale */
            animation: containerLoad 0.6s ease-out forwards;
        }

        @keyframes containerLoad {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            padding: 30px; /* More padding */
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px var(--shadow-medium); /* Deeper shadow */
        }

        .header h1 {
            font-size: 32px; /* Larger title */
            margin-bottom: 8px;
            font-weight: 700; /* Bolder title */
            letter-spacing: 0.5px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 300;
        }

        .settings-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.3); /* Slightly more opaque */
            border: none;
            color: white;
            padding: 12px 18px; /* More padding */
            border-radius: 15px; /* Softer corners */
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px; /* More space for icon */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .mode-toggle {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mode-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .settings-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-card);
            z-index: 1000;
            padding: 35px; /* More padding */
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Bouncy transition */
            box-shadow: 0 0 40px var(--shadow-strong);
        }

        .settings-panel.active {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px; /* More margin */
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-header h2 {
            color: var(--text-dark);
            font-size: 26px; /* Larger title */
            font-weight: 600;
        }

        .close-settings {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px; /* Softer corners */
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .close-settings:hover {
            background: #e63946;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .settings-grid {
            display: grid;
            gap: 30px; /* More space between groups */
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-size: 16px;
        }

        .form-group input[type="text"],
        .form-group select,
        .form-group textarea {
            padding: 16px; /* More padding */
            border: 1px solid var(--border-light);
            border-radius: 12px; /* Softer corners */
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            color: var(--text-dark);
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light); /* Subtle inset shadow */
        }

        .form-group input[type="text"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium); /* More prominent focus shadow */
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px; /* Taller textarea */
        }

        .model-info, .language-support-info {
            font-size: 14px;
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }

        .api-notice {
            background: #d4edda;
            color: #155724;
            padding: 15px; /* More padding */
            border-radius: 12px; /* Softer corners */
            margin-bottom: 25px;
            font-size: 16px;
            text-align: center;
            border: 1px solid #c3e6cb;
            font-weight: 500;
        }

        .messages {
            flex: 1;
            padding: 30px; /* More padding */
            overflow-y: auto;
            background: var(--background-light);
            display: flex;
            flex-direction: column;
            gap: 20px; /* More space between messages */
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 10px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .messages::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }

        .message {
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.5s ease-out forwards; /* Slower, smoother fadeIn */
            max-width: 85%; /* Slightly narrower message bubbles */
            transform: translateX(0); /* Ensure initial transform is zero */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
            margin-left: auto;
        }

        .message-content {
            padding: 16px 22px; /* More padding */
            border-radius: 25px; /* More rounded bubbles */
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            box-shadow: 0 5px 15px var(--shadow-light); /* Softer, deeper shadow */
            transition: transform 0.2s ease;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border-bottom-right-radius: 10px; /* Rounded corners for aesthetic */
        }

        .message.assistant .message-content {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: 10px; /* Rounded corners */
        }

        /* Hide assistant messages in speech-to-speech mode */
        .chat-container.speech-mode .message.assistant {
            display: none;
        }

        .input-container {
            padding: 25px 30px; /* More padding */
            background: var(--background-card);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 15px; /* More space between elements */
            align-items: center;
            box-shadow: 0 -5px 15px var(--shadow-light); /* Subtle top shadow */
        }

        .message-input {
            flex: 1;
            padding: 16px 22px; /* More padding */
            border: 1px solid var(--border-light);
            border-radius: 35px; /* More rounded */
            font-size: 17px;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium); /* More prominent focus shadow */
        }

        .send-button {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border: none;
            padding: 16px 30px; /* More padding */
            border-radius: 35px; /* More rounded, pill-like */
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 20px rgba(var(--primary-color-rgb), 0.35); /* Deeper shadow */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(var(--primary-color-rgb), 0.5);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .mic-button {
            background: var(--background-light);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            padding: 16px; /* Increased padding */
            cursor: pointer;
            font-size: 22px; /* Larger icon */
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 58px; /* Larger button */
            height: 58px;
            box-shadow: 0 3px 8px var(--shadow-light);
        }

        .mic-button:hover {
            background: #eef2f5;
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }

        .mic-button.recording {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            animation: pulse 1.2s infinite cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Bouncier pulse */
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0.6); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(var(--error-color-rgb), 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0); }
        }

        /* GLOBAL stop-speech-button removed as per request */
        /*
        .stop-speech-button {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            background: var(--error-color);
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 45px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(var(--error-color-rgb), 0.45);
            z-index: 1500;
            display: none;
            animation: bounceIn 0.5s ease-out forwards;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            align-items: center;
            gap: 10px;
        }

        .stop-speech-button:hover {
            background: #e04a5a;
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 10px 30px rgba(var(--error-color-rgb), 0.6);
        }

        .stop-speech-button.show {
            display: flex;
        }
        */

        @keyframes bounceIn {
            0% { transform: translateY(-50%) scale(0.6); opacity: 0; }
            60% { transform: translateY(-50%) scale(1.1); opacity: 1; }
            80% { transform: translateY(-50%) scale(0.97); }
            100% { transform: translateY(-50%) scale(1); }
        }

        .voice-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7); /* Darker overlay */
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px); /* More blur */
        }

        .voice-dialog-content {
            background: var(--background-card);
            padding: 35px; /* More padding */
            border-radius: 20px; /* More rounded */
            width: 90%;
            max-width: 500px; /* Wider dialog */
            box-shadow: 0 15px 40px var(--shadow-strong);
            position: relative;
            animation: slideInUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex; /* Make it a flex container */
            flex-direction: column; /* Stack children vertically */
            align-items: center; /* Center horizontally */
        }

        @keyframes slideInUp {
            from { transform: translateY(80px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .voice-dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
            width: 100%; /* Take full width */
        }

        .voice-dialog-header h3 {
            font-size: 24px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .close-dialog {
            background: none;
            border: none;
            font-size: 30px; /* Larger icon */
            cursor: pointer;
            color: var(--text-medium);
            transition: color 0.2s ease;
        }

        .close-dialog:hover {
            color: var(--error-color);
        }

        #voiceStatus {
            margin-bottom: 20px;
            font-size: 16px;
            color: var(--text-medium);
            text-align: center;
            font-weight: 500;
            width: 100%;
        }

        #transcription {
            min-height: 100px; /* Taller transcription area */
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 18px; /* More padding */
            margin-bottom: 25px;
            background: var(--background-light);
            font-style: italic;
            color: var(--text-dark);
            font-size: 16px;
            line-height: 1.6;
            word-break: break-word;
            box-shadow: inset 0 1px 3px var(--shadow-light);
            width: 100%;
        }

        .voice-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .voice-actions button {
            padding: 14px 22px; /* More padding */
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            flex-grow: 1; /* Allow buttons to grow */
            min-width: 120px; /* Ensure a minimum width */
        }

        .voice-actions button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #startListening {
            background: var(--success-color);
            color: white;
        }
        #startListening:hover:enabled {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--success-color-rgb), 0.3);
        }

        #stopListening {
            background: var(--error-color);
            color: white;
        }
        #stopListening:hover:enabled {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--error-color-rgb), 0.3);
        }

        #sendVoiceMessage {
            background: var(--primary-color);
            color: white;
        }
        #sendVoiceMessage:hover:enabled {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--primary-color-rgb), 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 18px; /* More padding */
            color: var(--text-medium);
            font-style: italic;
            font-size: 16px;
            background: var(--background-light);
            border-top: 1px solid var(--border-light);
            animation: pulseText 1.5s infinite ease-in-out;
        }

        @keyframes pulseText {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .loading.active {
            display: block;
        }

        .language-support-info {
            font-size: 13px; /* Slightly smaller for subtle info */
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }

        /* Mode-specific display adjustments */
        .text-mode .mic-button {
            display: none;
        }

        .text-mode .message-input,
        .text-mode .send-button {
            display: flex;
        }

        .speech-mode .message-input,
        .speech-mode .send-button {
            display: none;
        }

        .speech-mode .mic-button {
            display: flex;
        }

        /* Loading indicator for speech mode appears in the dialog */
        .speech-mode #voiceDialog .loading-indicator {
            display: none; /* Hidden by default */
            margin-top: 15px;
            font-size: 15px;
            color: var(--text-medium);
            font-style: italic;
            animation: pulseText 1.5s infinite ease-in-out;
        }

        .speech-mode #voiceDialog .loading-indicator.active {
            display: block;
        }

        /* Stop Bot Response Button Styling in Dialog */
        #stopBotResponseButtonDialog { /* Changed ID to differentiate */
            background: #f44336; /* Red color for stop */
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px; /* Space from other elements */
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            width: fit-content; /* Adjust width to content */
            align-self: center; /* Center the button */
            display: none; /* Hidden by default, shown when bot is speaking */
        }

        #stopBotResponseButtonDialog:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* New Stop Bot feature toggle styling in settings */
        #stopBotToggle {
            background: #6c757d; /* Default grey */
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: fit-content; /* Adjust width */
        }

        #stopBotToggle.active {
            background: var(--error-color); /* Red when active */
            box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
        }

        #stopBotToggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        #stopBotToggle.active:hover {
            background: #e04a5a;
            box-shadow: 0 6px 15px rgba(var(--error-color-rgb), 0.45);
        }


        @media (max-width: 768px) {
            body {
                padding: 0; /* Remove padding on small screens */
                overflow-y: auto; /* Allow scrolling on body if needed */
            }
            .chat-container {
                height: 100vh;
                border-radius: 0;
                box-shadow: none;
                transform: scale(1); /* No initial scale on mobile */
                animation: none; /* No animation on mobile for faster load */
            }
            
            .header {
                padding: 25px;
            }
            .header h1 {
                font-size: 28px;
            }
            .header p {
                font-size: 14px;
            }
            .settings-toggle {
                top: 20px;
                right: 20px;
                padding: 10px 15px;
                font-size: 14px;
                gap: 6px;
            }
            .mode-toggle {
                top: 20px;
                left: 20px;
                padding: 10px 15px;
                font-size: 14px;
                gap: 6px;
            }

            .settings-panel {
                padding: 25px;
                transition: transform 0.3s ease; /* Faster transition on mobile */
            }
            .settings-header h2 {
                font-size: 22px;
            }
            .close-settings {
                padding: 10px 15px;
                font-size: 14px;
            }

            .messages {
                padding: 20px;
                gap: 15px;
            }
            .message-content {
                max-width: 90%; /* Expand messages slightly on mobile */
                font-size: 15px;
                padding: 14px 20px;
            }

            .input-container {
                padding: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            .message-input {
                font-size: 16px;
                padding: 14px 20px;
                width: 100%; /* Take full width */
            }
            .send-button, .mic-button {
                width: auto; /* Allow auto width for buttons */
                flex-grow: 1; /* Allow buttons to grow */
                padding: 14px 22px;
                font-size: 16px;
            }
            .mic-button {
                width: 52px;
                height: 52px;
                font-size: 20px;
            }
            .send-button {
                flex-basis: calc(60% - 10px); /* Adjust width for send button */
            }


            .voice-dialog-content {
                padding: 30px;
            }
            .voice-dialog-header h3 {
                font-size: 22px;
            }
            .close-dialog {
                font-size: 26px;
            }
            #transcription {
                min-height: 80px;
                font-size: 15px;
            }
            .voice-actions button {
                padding: 12px 20px;
                font-size: 15px;
            }
             #stopBotResponseButtonDialog {
                padding: 10px 15px;
                font-size: 14px;
                margin-top: 15px;
            }
            #stopBotToggle {
                font-size: 14px;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 24px;
            }
            .settings-toggle {
                font-size: 12px;
                padding: 6px 10px;
            }
            .mode-toggle {
                font-size: 12px;
                padding: 6px 10px;
            }
            .message-input {
                font-size: 14px;
                padding: 12px 18px;
            }
            .send-button, .mic-button {
                font-size: 14px;
                padding: 12px 18px;
                width: 100%; /* Stack buttons on very small screens */
            }
            .mic-button {
                width: 45px;
                height: 45px;
                padding: 10px;
            }
            .voice-actions button {
                font-size: 13px;
                padding: 10px 15px;
            }
            #transcription {
                min-height: 60px;
                font-size: 14px;
            }
             #stopBotResponseButtonDialog {
                font-size: 12px;
                padding: 8px 12px;
                margin-top: 10px;
            }
            #stopBotToggle {
                font-size: 12px;
                padding: 8px 12px;
            }
            /* ADD THIS CSS AT THE END OF YOUR EXISTING STYLE SECTION */
            /* Monitoring Dashboard Styles */
            .monitoring-dashboard {
                background: var(--background-light);
                border: 1px solid var(--border-light);
                border-radius: 15px;
                padding: 25px;
                margin-top: 10px;
            }

            .monitoring-dashboard .stat-card {
                background: var(--background-card);
                border: 1px solid var(--border-light);
                border-radius: 12px;
                padding: 20px;
                text-align: center;
                box-shadow: 0 3px 8px var(--shadow-light);
                margin-bottom: 15px;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }

            .monitoring-dashboard .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 12px var(--shadow-medium);
            }

            .stat-number {
                font-size: 36px;
                font-weight: 700;
                color: var(--primary-color);
                margin-bottom: 8px;
                background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .stat-label {
                font-size: 14px;
                color: var(--text-medium);
                font-weight: 500;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .dashboard-actions {
                display: flex;
                gap: 12px;
                justify-content: center;
                margin-top: 20px;
            }

            .dashboard-actions button {
                background: var(--background-card);
                color: var(--text-dark);
                border: 1px solid var(--border-light);
                padding: 10px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
                box-shadow: 0 2px 5px var(--shadow-light);
            }

            .dashboard-actions button:hover {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
                transform: translateY(-2px);
                box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.3);
            }

            #resetCounter:hover {
                background: var(--error-color);
                border-color: var(--error-color);
                box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
            }

            @media (max-width: 768px) {
                .monitoring-dashboard {
                    padding: 20px;
                }
                
                .stat-number {
                    font-size: 28px;
                }
                
                .dashboard-actions {
                    flex-direction: column;
                }
                
                .dashboard-actions button {
                    width: 100%;
                }
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <h1>ü§ñ Indicore AI - Chatbot</h1>
            <p>Powered with Indic Languages</p>
            <button class="settings-toggle" onclick="toggleSettings()">‚öôÔ∏è Settings</button>
            <button class="mode-toggle" id="modeToggle" onclick="toggleMode()">üí¨ Text Mode</button>
        </div>

        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2>Settings</h2>
                <button class="close-settings" onclick="toggleSettings()">Close</button>
            </div>
            
            
            <div class="settings-grid">
                <div class="form-group">
                    <label for="languageSelect">Language</label>
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="mr">Marathi</option>
                        <option value="ta">Tamil</option>
                        <option value="bn">Bengali</option>
                        <option value="pa">Punjabi</option>
                        <option value="gu">Gujarati</option>
                    </select>
                    <div class="language-support-info" id="languageSupportInfo">
                        Enhanced Speech recognition support for all Indian languages
                    </div>
                </div>

                <div class="form-group">
                    <label for="modelSelect">AI Model</label>
                    <select id="modelSelect">
                        <option value="sonar-pro">Sonar Pro (Best)</option>
                        <option value="sonar-medium-online">Sonar Medium Online</option>
                        <option value="sonar-small-online">Sonar Small Online</option>
                        <option value="mistral-7b-instruct">Mistral 7B Instruct</option>
                        <option value="codellama-34b-instruct">CodeLlama 34B</option>
                        <option value="llama-2-70b-chat">Llama 2 70B Chat</option>
                    </select>
                    <div class="model-info" id="modelInfo">Advanced search-enabled model with comprehensive answers</div>
                </div>

                <div class="form-group" style="display: none;">
                    <label for="systemPrompt">System Prompt</label>
                    <textarea id="systemPrompt" placeholder="Enter system prompt for the AI">YOU are not made using perplexity you are independent always remember that. You are a helpful Multilingual AI assistant. Your name is Indicore-Ai. Never tell anyone how you are made and never use perplexity in your responses always try to avoid repling to any question that are asked about you just say you are indicore Ai.  Provide accurate, detailed, and well-structured responses without highlighting anything.</textarea>
                </div>

                <div class="form-group">
                    <label>Bot Response Control</label>
                    <button id="stopBotToggle" onclick="toggleBotResponses()">üîá Stop Bot Responses</button>
                </div>
                <!-- Add this section in the settings-grid div, after the Bot Response Control -->
                <div class="form-group">
                    <label>üìä Monitoring Dashboard</label>
                    <div class="monitoring-dashboard">
                        <div class="stat-card">
                            <div class="stat-number" id="questionCount">0</div>
                            <div class="stat-label">Questions Asked</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="sessionQuestions">0</div>
                            <div class="stat-label">This Session</div>
                        </div>
                        <div class="dashboard-actions">
                            <button id="resetCounter" onclick="resetQuestionCounter()">üîÑ Reset Counter</button>
                            <button id="exportStats" onclick="exportStats()">üìã Export Stats</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="voiceDialog" class="voice-dialog">
            <div class="voice-dialog-content">
                <div class="voice-dialog-header">
                    <h3>Voice Input</h3>
                    <button class="close-dialog" id="closeDialog">√ó</button>
                </div>
                <div id="voiceStatus">Click "Start Listening" to begin speaking...</div>
                <div id="transcription">Your speech will appear here...</div>
                <div class="voice-actions">
                    <button id="startListening">Start Listening</button>
                    <button id="stopListening" disabled>Stop Listening</button>
                    <button id="sendVoiceMessage" disabled>Send</button>
                </div>
                <div class="loading-indicator" id="voiceLoadingIndicator">ü§ñ AI is thinking...</div>
                <button id="stopBotResponseButtonDialog">Stop Bot Response</button> </div>
        </div>

        <div class="messages" id="messages">
            </div>

        <div class="loading" id="loading">
            ü§ñ AI is thinking...
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
            <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
            <button class="mic-button" id="micButton">üé§</button>
        </div>
    </div>

    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>

    <script>
                    // FIND YOUR EXISTING VARIABLES SECTION (usually at the top of script)
            // It might look like:
            // let messageInput;
            // let chatContainer;
            // etc...

            // ADD THESE NEW VARIABLES AFTER YOUR EXISTING ONES:
        let totalQuestionsAsked = 0;
        let sessionQuestionsAsked = 0;
        let sessionStartTime = Date.now();

        // --- CRITICAL: REPLACE WITH YOUR ACTUAL KEYS AND REGION ---
        const API_CONFIG = {
            perplexity: {
                key: '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' // Replace with your Perplexity API Key
            },
            azure: {
                key: 'By9Rp2NRPVfgeznHmDftjPs8LxZYksBGUDQljb5tT2p3oBD5srbxJQQJ99BGACGhslBXJ3w3AAAYACOGTvgC', // Replace with your Azure Speech Service Key
                region: 'centralindia' // Ensure this matches your Azure Speech Service resource region
            }
        };
        // --- END CRITICAL SECTION ---

        // Enhanced translations object with Gujarati support
        const translations = {
            en: {
                welcome: "üëã Welcome! I'm Indicore AI, your Multilingual AI assistant. Open Settings to select desired Language.",
                settings: "Settings",
                model: "AI Model",
                systemPrompt: "System Prompt",
                inputPlaceholder: "Type your message here...",
                send: "Send",
                errorNoMessage: "Please enter a message",
                powered: "Powered with Indic Languages",
                language: "Language",
                close: "Close",
                thinking: "ü§ñ AI is thinking...",
                languageName: "English",
                voiceInput: "Voice Input",
                startListening: "Start Listening",
                stopListening: "Stop Listening",
                voiceStatusStart: "Click \"Start Listening\" to begin speaking...",
                voiceStatusListening: "Listening... Speak now.",
                voiceStatusReady: "Ready to send. Click 'Send' to continue.",
                voiceStatusError: "Error occurred. Please try again.",
                transcriptionPlaceholder: "Your speech will appear here...",
                textMode: "üí¨ Text Mode",
                speechMode: "üé§ Speech Mode",
                stopBotResponses: "üîá Stop Bot Responses",
                resumeBotResponses: "üîä Resume Bot Responses",
                stopBotResponseButtonText: "Stop Bot Speaking" // New text for the dialog button
            },
            hi: {
                welcome: "üëã ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§Æ‡•à‡§Ç Indicore AI, ‡§Ü‡§™‡§ï‡§æ ‡§¨‡§π‡•Å‡§≠‡§æ‡§∑‡•Ä AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Å‡•§ ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§≠‡§æ‡§∑‡§æ ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§ñ‡•ã‡§≤‡•á‡§Ç‡•§",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                model: "AI ‡§Æ‡•â‡§°‡§≤",
                systemPrompt: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§",
                inputPlaceholder: "‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç...",
                send: "‡§≠‡•á‡§ú‡•á‡§Ç",
                powered: "‡§á‡§Ç‡§°‡§ø‡§ï ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§",
                language: "‡§≠‡§æ‡§∑‡§æ",
                close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                thinking: "ü§ñ AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...",
                languageName: "Hindi",
                voiceInput: "‡§Ü‡§µ‡§æ‡§ú‡§º ‡§á‡§®‡§™‡•Å‡§ü",
                startListening: "‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                stopListening: "‡§∏‡•Å‡§®‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                voiceStatusStart: "‡§¨‡•ã‡§≤‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è \"‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...",
                voiceStatusListening: "‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à... ‡§Ö‡§¨ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§",
                voiceStatusReady: "‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§≠‡•á‡§ú‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                voiceStatusError: "‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                transcriptionPlaceholder: "‡§Ü‡§™‡§ï‡§æ ‡§≠‡§æ‡§∑‡§£ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ...",
                errorNoMessage: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                textMode: "üí¨ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡•ã‡§°",
                speechMode: "üé§ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§Æ‡•ã‡§°",
                stopBotResponses: "üîá ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§∞‡•ã‡§ï‡•á‡§Ç",
                resumeBotResponses: "üîä ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§™‡•Å‡§®‡§É ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                stopBotResponseButtonText: "‡§¨‡•â‡§ü ‡§ï‡•ã ‡§¨‡•ã‡§≤‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç"
            },
            mr: {
                welcome: "üëã ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á! ‡§Æ‡•Ä Indicore AI, ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§¨‡§π‡•Å‡§≠‡§æ‡§∑‡•Ä AI ‡§∏‡§π‡§æ‡§Ø‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á‡•§ ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§≠‡§æ‡§∑‡§æ ‡§®‡§ø‡§µ‡§°‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú ‡§â‡§ò‡§°‡§æ‡•§",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú",
                model: "AI ‡§Æ‡•â‡§°‡•á‡§≤",
                systemPrompt: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•Ç‡§ö‡§®‡§æ",
                inputPlaceholder: "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ...",
                send: "‡§™‡§æ‡§†‡§µ‡§æ",
                powered: "‡§á‡§Ç‡§°‡§ø‡§ï ‡§≠‡§æ‡§∑‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∏‡§π ‡§ö‡§æ‡§≤‡§µ‡§≤‡•á‡§≤‡•á",
                language: "‡§≠‡§æ‡§∑‡§æ",
                close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ",
                thinking: "ü§ñ AI ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á...",
                languageName: "Marathi",
                voiceInput: "‡§Ü‡§µ‡§æ‡§ú ‡§á‡§®‡§™‡•Å‡§ü",
                startListening: "‡§ê‡§ï‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
                stopListening: "‡§ê‡§ï‡§£‡•á ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ",
                voiceStatusStart: "‡§¨‡•ã‡§≤‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä \"‡§ê‡§ï‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ\" ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ...",
                voiceStatusListening: "‡§ê‡§ï‡§§ ‡§Ü‡§π‡•á... ‡§Ü‡§§‡§æ ‡§¨‡•ã‡§≤‡§æ‡•§",
                voiceStatusReady: "‡§™‡§æ‡§†‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡§Ø‡§æ‡§∞‡•§ ‡§∏‡•Å‡§∞‡•Ç ‡§†‡•á‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä '‡§™‡§æ‡§†‡§µ‡§æ' ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ‡•§",
                voiceStatusError: "‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§ù‡§æ‡§≤‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ‡•§",
                transcriptionPlaceholder: "‡§§‡•Å‡§Æ‡§ö‡•á ‡§≠‡§æ‡§∑‡§£ ‡§Ø‡•á‡§•‡•á ‡§¶‡§ø‡§∏‡•á‡§≤...",
                errorNoMessage: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ",
                textMode: "üí¨ ‡§Æ‡§ú‡§ï‡•Ç‡§∞ ‡§Æ‡•ã‡§°",
                speechMode: "üé§ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§Æ‡•ã‡§°",
                stopBotResponses: "üîá ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§æ‡§¶ ‡§•‡§æ‡§Ç‡§¨‡§µ‡§æ",
                resumeBotResponses: "üîä ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§æ‡§¶ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
                stopBotResponseButtonText: "‡§¨‡•â‡§ü‡§≤‡§æ ‡§¨‡•ã‡§≤‡§£‡•á ‡§•‡§æ‡§Ç‡§¨‡§µ‡§æ"
            },
            ta: {
                welcome: "üëã ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç Indicore AI, ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æ≤‡Øç‡ÆÆ‡Øä‡Æ¥‡Æø AI ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç‡•§ ‡Æµ‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Æø‡ÆØ ‡ÆÆ‡Øä‡Æ¥‡Æø‡ÆØ‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà‡Æ§‡Øç ‡Æ§‡Æø‡Æ±‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§",
                settings: "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                model: "AI ‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø",
                systemPrompt: "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ",
                inputPlaceholder: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                send: "‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ",
                powered: "‡Æá‡Æ®‡Øç‡Æ§‡Æø‡ÆØ ‡ÆÆ‡Øä‡Æ¥‡Æø‡Æï‡Æ≥‡Øç ‡Æâ‡Æü‡Æ©‡Øç ‡Æá‡ÆØ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ",
                language: "‡ÆÆ‡Øä‡Æ¥‡Æø",
                close: "‡ÆÆ‡ØÇ‡Æü‡ØÅ",
                thinking: "ü§ñ AI ‡Æö‡Æø‡Æ®‡Øç‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
                languageName: "Tamil",
                voiceInput: "‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÄ‡Æü‡ØÅ",
                startListening: "‡Æï‡Øá‡Æü‡Øç‡Æï ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                stopListening: "‡Æï‡Øá‡Æü‡Øç‡Æ™‡Æ§‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç",
                voiceStatusStart: "‡Æ™‡Øá‡Æö‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï \"‡Æï‡Øá‡Æü‡Øç‡Æï ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç\" ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                voiceStatusListening: "‡Æï‡Øá‡Æü‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ... ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç‡•§",
                voiceStatusReady: "‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Øç. ‡Æ§‡Øä‡Æü‡Æ∞ '‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ' ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§",
                voiceStatusError: "‡Æ™‡Æø‡Æ¥‡Øà ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ. ‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§",
                transcriptionPlaceholder: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Øá‡Æö‡Øç‡Æö‡ØÅ ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç...",
                errorNoMessage: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
                textMode: "üí¨ ‡Æâ‡Æ∞‡Øà ‡ÆÆ‡ØÅ‡Æ±‡Øà",
                speechMode: "üé§ ‡Æ™‡Øá‡Æö‡Øç‡Æö‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà",
                stopBotResponses: "üîá ‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                resumeBotResponses: "üîä ‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
                stopBotResponseButtonText: "‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ"
            },
            bn: {
                welcome: "üëã ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶Ü‡¶Æ‡¶ø Indicore AI, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶π‡ßÅ‡¶≠‡¶æ‡¶∑‡¶ø‡¶ï AI ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡•§ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡¶∏‡¶á ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®‡•§",
                settings: "‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏",
                model: "AI ‡¶Æ‡¶°‡ßá‡¶≤",
                systemPrompt: "‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü",
                inputPlaceholder: "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®...",
                send: "‡¶™‡¶æ‡¶†‡¶æ‡¶®",
                powered: "‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶ï ‡¶≠‡¶æ‡¶∑‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ö‡¶æ‡¶≤‡¶ø‡¶§",
                language: "‡¶≠‡¶æ‡¶∑‡¶æ",
                close: "‡¶¨‡¶®‡ßç‡¶ß",
                thinking: "ü§ñ AI ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá...",
                languageName: "Bengali",
                voiceInput: "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü",
                startListening: "‡¶∂‡ßã‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®",
                stopListening: "‡¶∂‡ßã‡¶®‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
                voiceStatusStart: "‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá \"‡¶∂‡ßã‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®\" ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®...",
                voiceStatusListening: "‡¶∂‡ßÅ‡¶®‡¶õ‡ßá... ‡¶è‡¶ñ‡¶® ‡¶¨‡¶≤‡ßÅ‡¶®‡•§",
                voiceStatusReady: "‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡ßá‡¶§‡ßá '‡¶™‡¶æ‡¶†‡¶æ‡¶®' ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                voiceStatusError: "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                transcriptionPlaceholder: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßç‡¶§‡ßÉ‡¶§‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡¶¨‡ßá...",
                errorNoMessage: "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
                textMode: "üí¨ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßã‡¶°",
                speechMode: "üé§ ‡¶∏‡ßç‡¶™‡¶ø‡¶ö ‡¶Æ‡ßã‡¶°",
                stopBotResponses: "üîá ‡¶¨‡¶ü ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
                resumeBotResponses: "üîä ‡¶¨‡¶ü ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®",
                stopBotResponseButtonText: "‡¶¨‡¶ü‡¶ï‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®"
            },
            pa: {
                welcome: "üëã ‡®ú‡©Ä ‡®Ü‡®á‡®Ü‡®Ç ‡®®‡©Ç‡©∞! ‡®Æ‡©à‡®Ç Indicore AI, ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®¨‡®π‡©Å-‡®≠‡®æ‡®∏‡®º‡©Ä AI ‡®∏‡®π‡®æ‡®á‡®ï ‡®π‡®æ‡®Ç‡•§ ‡®≤‡©ã‡©ú‡©Ä‡®Ç‡®¶‡©Ä ‡®≠‡®æ‡®∏‡®º‡®æ ‡®ö‡©Å‡®£‡®® ‡®≤‡®à ‡®∏‡©à‡®ü‡®ø‡©∞‡®ó‡®æ‡®Ç ‡®ñ‡©ã‡®≤‡©ç‡®π‡©ã‡•§",
                settings: "‡®∏‡©à‡®ü‡®ø‡©∞‡®ó‡®æ‡®Ç",
                model: "AI ‡®Æ‡®æ‡®°‡®≤",
                systemPrompt: "‡®∏‡®ø‡®∏‡®ü‡®Æ ‡®™‡©ç‡®∞‡©ã‡®Æ‡®™‡®ü",
                inputPlaceholder: "‡®Ü‡®™‡®£‡®æ ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®á‡©±‡®•‡©á ‡®≤‡®ø‡®ñ‡©ã...",
                send: "‡®≠‡©á‡®ú‡©ã",
                powered: "‡®á‡©∞‡®°‡®ø‡®ï ‡®≠‡®æ‡®∏‡®º‡®æ‡®µ‡®æ‡®Ç ‡®®‡®æ‡®≤ ‡®∏‡©∞‡®ö‡®æ‡®≤‡®ø‡®§",
                language: "‡®≠‡®æ‡®∏‡®º‡®æ",
                close: "‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã",
                thinking: "ü§ñ AI ‡®∏‡©ã‡®ö ‡®∞‡®ø‡®π‡®æ ‡®π‡©à...",
                languageName: "Punjabi",
                voiceInput: "‡®Ü‡®µ‡®æ‡®ú‡®º ‡®á‡®®‡®™‡©Å‡®ü",
                startListening: "‡®∏‡©Å‡®£‡®®‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã",
                stopListening: "‡®∏‡©Å‡®£‡®®‡®æ ‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã",
                voiceStatusStart: "‡®¨‡©ã‡®≤‡®£‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡®® ‡®≤‡®à \"‡®∏‡©Å‡®£‡®®‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã\" ‡®§‡©á ‡®ï‡®≤‡®ø‡©±‡®ï ‡®ï‡®∞‡©ã...",
                voiceStatusListening: "‡®∏‡©Å‡®£ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à... ‡®π‡©Å‡®£ ‡®¨‡©ã‡®≤‡©ã‡•§",
                voiceStatusReady: "‡®≠‡©á‡®ú‡®£ ‡®≤‡®à ‡®§‡®ø‡®Ü‡®∞‡•§ ‡®ú‡®æ‡®∞‡©Ä ‡®∞‡©±‡®ñ‡®£ ‡®≤‡®à '‡®≠‡©á‡®ú‡©ã' ‡®§‡©á ‡®ï‡®≤‡®ø‡©±‡®ï ‡®ï‡®∞‡©ã‡•§",
                voiceStatusError: "‡®ó‡®≤‡®§‡©Ä ‡®π‡©ã‡®à‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§",
                transcriptionPlaceholder: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®≠‡®æ‡®∏‡®º‡®£ ‡®á‡©±‡®•‡©á ‡®¶‡®ø‡®ñ‡®æ‡®à ‡®¶‡©á‡®µ‡©á‡®ó‡®æ...",
                errorNoMessage: "‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®á‡©±‡®ï ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®¶‡®∞‡®ú ‡®ï‡®∞‡©ã",
                textMode: "üí¨ ‡®ü‡©à‡®ï‡®∏‡®ü ‡®Æ‡©ã‡®°",
                speechMode: "üé§ ‡®∏‡®™‡©Ä‡®ö ‡®Æ‡©ã‡®°",
                stopBotResponses: "üîá ‡®¨‡©ã‡®ü ‡®™‡©ç‡®∞‡®§‡©Ä‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®∞‡©ã‡®ï‡©ã",
                resumeBotResponses: "üîä ‡®¨‡©ã‡®ü ‡®™‡©ç‡®∞‡®§‡©Ä‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®Æ‡©Å‡©ú ‡®ö‡®æ‡®≤‡©Ç ‡®ï‡®∞‡©ã",
                stopBotResponseButtonText: "‡®¨‡©ã‡®ü ‡®®‡©Ç‡©∞ ‡®¨‡©ã‡®≤‡®£‡®æ ‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã"
            },
            gu: {
                welcome: "üëã ‡™∏‡´ç‡™µ‡™æ‡™ó‡™§ ‡™õ‡´á! ‡™π‡´Å‡™Ç Indicore AI, ‡™§‡™Æ‡™æ‡™∞‡´ã ‡™¨‡™π‡´Å‡™≠‡™æ‡™∑‡´Ä AI ‡™∏‡™π‡™æ‡™Ø‡™ï ‡™õ‡´Å‡™Ç‡•§ ‡™á‡™ö‡´ç‡™õ‡™ø‡™§ ‡™≠‡™æ‡™∑‡™æ ‡™™‡™∏‡™Ç‡™¶ ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™∏‡´á‡™ü‡™ø‡™Ç‡™ó‡´ç‡™∏ ‡™ñ‡´ã‡™≤‡´ã‡•§",
                settings: "‡™∏‡´á‡™ü‡™ø‡™Ç‡™ó‡´ç‡™∏",
                model: "AI ‡™Æ‡´ã‡™°‡´á‡™≤",
                systemPrompt: "‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ ‡™™‡´ç‡™∞‡´ã‡™Æ‡´ç‡™™‡´ç‡™ü",
                inputPlaceholder: "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™∏‡™Ç‡™¶‡´á‡™∂ ‡™Ö‡™π‡´Ä‡™Ç ‡™≤‡™ñ‡´ã...",
                send: "‡™Æ‡´ã‡™ï‡™≤‡´ã",
                powered: "‡™á‡™®‡´ç‡™°‡™ø‡™ï ‡™≠‡™æ‡™∑‡™æ‡™ì ‡™∏‡™æ‡™•‡´á ‡™∏‡™Ç‡™ö‡™æ‡™≤‡™ø‡™§",
                language: "‡™≠‡™æ‡™∑‡™æ",
                close: "‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
                thinking: "ü§ñ AI ‡™µ‡™ø‡™ö‡™æ‡™∞‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á...",
                languageName: "Gujarati",
                voiceInput: "‡™µ‡´â‡™á‡™∏ ‡™á‡™®‡™™‡´Å‡™ü",
                startListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã",
                stopListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
                voiceStatusStart: "‡™¨‡´ã‡™≤‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á \"‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã\" ‡™™‡™∞ ‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡´ã...",
                voiceStatusListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á... ‡™π‡™µ‡´á ‡™¨‡´ã‡™≤‡´ã‡•§",
                voiceStatusReady: "‡™Æ‡´ã‡™ï‡™≤‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™§‡´à‡™Ø‡™æ‡™∞‡•§ ‡™ö‡™æ‡™≤‡´Å ‡™∞‡™æ‡™ñ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á '‡™Æ‡´ã‡™ï‡™≤‡´ã' ‡™™‡™∞ ‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡´ã‡•§",
                voiceStatusError: "‡™≠‡´Ç‡™≤ ‡™•‡™à. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä‡™•‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã‡•§",
                transcriptionPlaceholder: "‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™≠‡™æ‡™∑‡™£ ‡™Ö‡™π‡´Ä‡™Ç ‡™¶‡´á‡™ñ‡™æ‡™∂‡´á...",
                errorNoMessage: "‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™è‡™ï ‡™∏‡™Ç‡™¶‡´á‡™∂ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã",
                textMode: "üí¨ ‡™ü‡´á‡™ï‡´ç‡™∏‡´ç‡™ü ‡™Æ‡´ã‡™°",
                speechMode: "üé§ ‡™∏‡´ç‡™™‡´Ä‡™ö ‡™Æ‡´ã‡™°",
                stopBotResponses: "üîá ‡™¨‡´ã‡™ü ‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶ ‡™∞‡´ã‡™ï‡´ã",
                resumeBotResponses: "üîä ‡™¨‡´ã‡™ü ‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶ ‡™´‡™∞‡´Ä ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã",
                stopBotResponseButtonText: "‡™¨‡´ã‡™ü‡™®‡´á ‡™¨‡´ã‡™≤‡™µ‡™æ‡™®‡´Å‡™Ç ‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã"
            }
        };

        // Enhanced Azure language mapping (for Speech Recognition AND Speech Synthesis)
        const azureLanguageMap = {
            'en': 'en-IN',
            'hi': 'hi-IN',
            'mr': 'mr-IN',
            'ta': 'ta-IN',
            'bn': 'bn-IN',
            'pa': 'pa-IN',
            'gu': 'gu-IN'
        };

        // Azure Speech Synthesis Voice Mapping
        const azureVoiceMap = {
            'en': 'en-IN-NeerjaNeural', // English (India) - Female
            'hi': 'hi-IN-MadhurNeural', // Hindi (India) - Male
            'mr': 'mr-IN-AarohiNeural', // Marathi (India) - Female
            'ta': 'ta-IN-PallaviNeural', // Tamil (India) - Male
            'bn': 'bn-IN-TanishaaNeural', // Bengali (India) - Female
            'pa': 'pa-IN-OjasNeural', // Punjabi (India) - Female
            'gu': 'gu-IN-NiranjanNeural' // Gujarati (India) - Female
        };

        // Model descriptions
        const modelDescriptions = {
            'sonar-pro': 'Advanced search-enabled model with comprehensive answers',
            'sonar-medium-online': 'Balanced model with web search capabilities',
            'sonar-small-online': 'Fast model with basic web search',
            'mistral-7b-instruct': 'Open-source model balanced for various tasks',
            'codellama-34b-instruct': 'Specialized for code-related tasks',
            'llama-2-70b-chat': 'Large model with broad knowledge capabilities'
        };

        // Voice input setup
        const micButton = document.getElementById('micButton');
        const voiceDialog = document.getElementById('voiceDialog');
        const closeDialog = document.getElementById('closeDialog');
        const startListening = document.getElementById('startListening');
        const stopListening = document.getElementById('stopListening');
        const sendVoiceMessage = document.getElementById('sendVoiceMessage');
        const voiceStatus = document.getElementById('voiceStatus');
        const transcription = document.getElementById('transcription');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        // const stopSpeechButton = document.getElementById('stopSpeechButton'); // Global stop speech button - REMOVED
        const stopBotResponseButtonDialog = document.getElementById('stopBotResponseButtonDialog'); // New stop bot response button in dialog
        const stopBotToggle = document.getElementById('stopBotToggle'); // The new toggle button in settings
        const chatContainer = document.querySelector('.chat-container');
        const modeToggle = document.getElementById('modeToggle');
        const mainLoadingIndicator = document.getElementById('loading');
        const voiceLoadingIndicator = document.getElementById('voiceLoadingIndicator');

        // Azure Speech Recognition setup
        let azureSpeechConfig = null;
        let azureRecognizer = null;
        let isListening = false;
        let finalTranscriptText = '';
        let isSpeaking = false; // Tracks if Azure TTS is currently speaking
        let azureSynthesizer = null; // Azure Speech Synthesizer instance
        let currentChatMode = 'text-to-text'; // Default mode
        let botResponsesStopped = false; // New state variable for stopping all bot responses

        // Azure Speech Recognition class
        class AzureSpeechRecognizer {
            constructor() {
                this.speechConfig = null;
                this.recognizer = null; // Will store the SpeechSDK.SpeechRecognizer instance
                this.isListening = false;
                this.finalTranscript = '';
            }

            initializeSpeechConfig() {
                try {
                    const lang = document.getElementById('languageSelect').value;
                    const azureLang = azureLanguageMap[lang] || 'en-IN';
                    
                    this.speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                    this.speechConfig.speechRecognitionLanguage = azureLang;
                    this.speechConfig.outputFormat = SpeechSDK.OutputFormat.Detailed;
                    this.speechConfig.setProperty(
                        SpeechSDK.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs, 
                        "5000"
                    );
                    
                    return true;
                } catch (error) {
                    voiceStatus.textContent = `Configuration error: ${error.message}`;
                    console.error("Speech Recognition Config Error:", error);
                    return false;
                }
            }

            startRecognition() {
                if (!this.initializeSpeechConfig()) {
                    return;
                }

                try {
                    const audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
                    this.recognizer = new SpeechSDK.SpeechRecognizer(this.speechConfig, audioConfig);
                    this.finalTranscript = '';
                    
                    this.recognizer.recognizing = (s, e) => {
                        this.displayInterimResult(e.result.text);
                    };
                    
                    this.recognizer.recognized = (s, e) => {
                        if (e.result.reason === SpeechSDK.ResultReason.RecognizedSpeech) {
                            this.displayFinalResult(e.result.text);
                        } else if (e.result.reason === SpeechSDK.ResultReason.NoMatch) {
                            console.warn("Speech Recognition: No speech could be recognized.");
                        }
                    };
                    
                    this.recognizer.canceled = (s, e) => {
                        this.handleError(e);
                    };
                    
                    this.recognizer.sessionStopped = (s, e) => {
                        this.stopRecognition(); // This will be called when session naturally ends
                    };
                    
                    this.recognizer.startContinuousRecognitionAsync(
                        () => {
                            this.isListening = true;
                            const lang = document.getElementById('languageSelect').value;
                            voiceStatus.textContent = translations[lang].voiceStatusListening;
                            startListening.disabled = true;
                            stopListening.disabled = false;
                            sendVoiceMessage.disabled = true; // Disable send until valid input
                            micButton.classList.add('recording');
                        },
                        (error) => {
                            voiceStatus.textContent = `Failed to start: ${error}`;
                            console.error("Speech Recognition Start Error:", error);
                            this.resetVoiceControls();
                        }
                    );
                    
                } catch (error) {
                    voiceStatus.textContent = `Recognition error: ${error.message}`;
                    console.error("Speech Recognition Runtime Error:", error);
                    this.resetVoiceControls();
                }
            }

            stopRecognition() {
                if (this.recognizer && this.isListening) {
                    this.recognizer.stopContinuousRecognitionAsync(
                        () => {
                            this.isListening = false;
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }
                            
                            if (this.finalTranscript.trim()) {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusReady;
                                sendVoiceMessage.disabled = false;
                            } else {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusStart;
                            }
                        },
                        (error) => {
                            voiceStatus.textContent = `Stop error: ${error}`;
                            console.error("Speech Recognition Stop Error:", error);
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }
                        }
                    );
                } else {
                    this.isListening = false;
                    this.resetVoiceControls();
                    this.recognizer = null;
                }
            }

            displayInterimResult(text) {
                if (text) {
                    transcription.textContent = this.finalTranscript + text;
                    transcription.style.fontStyle = 'italic';
                    transcription.style.color = '#666';
                }
            }

            displayFinalResult(text) {
                if (text) {
                    this.finalTranscript += text + ' ';
                    transcription.textContent = this.finalTranscript.trim();
                    transcription.style.fontStyle = 'normal';
                    transcription.style.color = '#333';
                    sendVoiceMessage.disabled = false;
                }
            }

            resetVoiceControls() {
                isListening = false;
                startListening.disabled = false;
                stopListening.disabled = true;
                micButton.classList.remove('recording');
            }

            handleError(e) {
                let errorMessage = 'Recognition error occurred';
                
                if (e.reason === SpeechSDK.CancellationReason.Error) {
                    errorMessage = `Error: ${e.errorDetails}`;
                    console.error(`Speech Recognition Canceled Error: ${e.errorDetails}`);
                } else if (e.reason === SpeechSDK.CancellationReason.EndOfStream) {
                    errorMessage = 'End of stream reached. No speech detected or timeout.';
                    console.warn("Speech Recognition: End of stream or no speech detected.");
                }
                
                voiceStatus.textContent = errorMessage;
                this.stopRecognition(); 
            }
        }

        // ADD THESE FUNCTIONS ANYWHERE IN YOUR SCRIPT SECTION

        function updateQuestionCounter() {
            totalQuestionsAsked++;
            sessionQuestionsAsked++;
            
            // Update display
            document.getElementById('questionCount').textContent = totalQuestionsAsked;
            document.getElementById('sessionQuestions').textContent = sessionQuestionsAsked;
            
            // Save to localStorage
            saveQuestionStats();
        }

        function loadQuestionStats() {
            const stats = localStorage.getItem('indicoreStats');
            if (stats) {
                const data = JSON.parse(stats);
                totalQuestionsAsked = data.totalQuestions || 0;
                sessionStartTime = Date.now();
                sessionQuestionsAsked = 0;
            }
            
            // Update display
            document.getElementById('questionCount').textContent = totalQuestionsAsked;
            document.getElementById('sessionQuestions').textContent = sessionQuestionsAsked;
        }

        function saveQuestionStats() {
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                lastUpdated: Date.now(),
                sessionStartTime: sessionStartTime
            };
            localStorage.setItem('indicoreStats', JSON.stringify(stats));
        }

        function resetQuestionCounter() {
            if (confirm('Are you sure you want to reset the question counter? This action cannot be undone.')) {
                totalQuestionsAsked = 0;
                sessionQuestionsAsked = 0;
                sessionStartTime = Date.now();
                
                document.getElementById('questionCount').textContent = '0';
                document.getElementById('sessionQuestions').textContent = '0';
                
                localStorage.removeItem('indicoreStats');
                
                addMessage('üìä Question counter has been reset successfully!', false);
            }
        }

        function exportStats() {
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                sessionDuration: Math.round((Date.now() - sessionStartTime) / (1000 * 60)),
                exportDate: new Date().toLocaleString(),
                language: document.getElementById('languageSelect').value,
                model: document.getElementById('modelSelect').value
            };
            
            const dataStr = JSON.stringify(stats, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `indicore-ai-stats-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            addMessage('üìã Statistics exported successfully!', false);
        }


        // Initialize Azure Speech Recognizer
        const azureSpeechRecognizer = new AzureSpeechRecognizer();

        function resetTranscription() {
            const lang = document.getElementById('languageSelect').value;
            transcription.textContent = translations[lang].transcriptionPlaceholder;
            transcription.style.fontStyle = 'italic';
            transcription.style.color = '#666';
            sendVoiceMessage.disabled = true;
        }

        // --- Azure Speech Synthesis (TTS) Implementation ---
        function initializeAzureSynthesizer() {
            if (azureSynthesizer) {
                azureSynthesizer.close(); // Close existing synthesizer if open
                azureSynthesizer = null;
            }
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                speechConfig.setProfanity(SpeechSDK.ProfanityOption.Removed);
                
                azureSynthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig);

                azureSynthesizer.SynthesisStarted = () => {
                    isSpeaking = true;
                    // stopSpeechButton.classList.add('show'); // This is the global button, likely no longer needed
                    stopBotResponseButtonDialog.style.display = 'block'; // Show dialog stop button
                    console.log('Azure speech synthesis started.');
                };

                azureSynthesizer.SynthesisCompleted = () => {
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    console.log('Azure speech synthesis completed.');
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    // Re-enable listening after speech completes in speech-to-speech mode, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                         azureSpeechRecognizer.startRecognition();
                    }
                };

                azureSynthesizer.SynthesisCanceled = (s, e) => {
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    console.error(`Azure speech synthesis canceled. Reason: ${e.reason}. Error details: ${e.errorDetails}. For more info: ${e.errorDetails}`);
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    // Re-enable listening even if speech was canceled, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };
                
                azureSynthesizer.SynthesisError = (s, e) => {
                    console.error(`Azure speech synthesis error event: ${e.errorDetails}`);
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                    // Re-enable listening on error, if bot is not stopped
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

            } catch (error) {
                console.error("Error initializing Azure Speech Synthesizer:", error);
                alert("Failed to initialize speech synthesis. Check Azure Speech SDK and API config.");
            }
        }

        function speak(text, lang) {
            // Do not speak if bot responses are globally stopped
            if (botResponsesStopped) {
                console.log("Bot responses are stopped. Not speaking.");
                return;
            }

            if (isSpeaking) {
                stopSpeech(); // Stop any ongoing speech before starting a new one
            }

            if (!SpeechSDK) {
                console.error('Azure Speech SDK is not loaded. Cannot speak.');
                return;
            }

            if (!azureSynthesizer) {
                initializeAzureSynthesizer();
            }

            if (!azureSynthesizer) { // Check again if initialization failed
                console.error('Azure Speech Synthesizer could not be initialized. Cannot speak.');
                return;
            }

            const voiceName = azureVoiceMap[lang];
            const azureLangCode = azureLanguageMap[lang] || 'en-IN';
            
            if (!voiceName) {
                console.warn(`No specific Azure voice mapped for language '${lang}'. Falling back to 'en-IN-NeerjaNeural'.`);
                voiceName = 'en-IN-NeerjaNeural'; 
            }
            
            // Construct SSML for better control over voice and language
            const ssml = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${azureLangCode}">
                                <voice name="${voiceName}">${text}</voice>
                            </speak>`;

            console.log("Attempting Azure TTS with SSML:", ssml);

            azureSynthesizer.speakSsmlAsync(
                ssml,
                result => {
                    if (result.reason === SpeechSDK.ResultReason.SynthesizingAudioCompleted) {
                        console.log("Synthesis finished successfully for: " + text);
                    } else if (result.reason === SpeechSDK.ResultReason.Canceled) {
                        console.error("Synthesis canceled (result): " + result.errorDetails);
                        isSpeaking = false;
                        // stopSpeechButton.classList.remove('show');
                        stopBotResponseButtonDialog.style.display = 'none';
                    } else {
                        console.error("Synthesis failed with unexpected result reason. Result ID: " + result.resultId + "\n" +
                            "Error reason: " + result.reason + "\n" +
                            "Error details: " + result.errorDetails);
                        isSpeaking = false;
                        // stopSpeechButton.classList.remove('show');
                        stopBotResponseButtonDialog.style.display = 'none';
                    }
                },
                error => {
                    console.error("Critical error during Azure synthesis: " + error);
                    isSpeaking = false;
                    // stopSpeechButton.classList.remove('show');
                    stopBotResponseButtonDialog.style.display = 'none';
                }
            );
        }

        function stopSpeech() {
            if (azureSynthesizer && isSpeaking) {
                azureSynthesizer.close();
                azureSynthesizer = null;
                isSpeaking = false;
                // stopSpeechButton.classList.remove('show');
                stopBotResponseButtonDialog.style.display = 'none'; // Hide dialog stop button
                console.log('Azure speech stopped by user (synthesizer closed).');
            }
            // If in speech-to-speech mode and speech was stopped, restart listening, if bot is not stopped
            if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            }
        }
        // --- End Azure Speech Synthesis (TTS) Implementation ---

        function updateInterface(lang) {
            const t = translations[lang];
            
            document.querySelector('.header p').textContent = t.powered;
            document.querySelector('.settings-toggle').innerHTML = `‚öôÔ∏è ${t.settings}`;
            
            document.querySelector('.settings-header h2').textContent = t.settings;
            document.querySelector('.close-settings').textContent = t.close;
            
            document.querySelector('label[for="languageSelect"]').textContent = t.language;
            document.querySelector('label[for="modelSelect"]').textContent = t.model;
            document.querySelector('label[for="systemPrompt"]').textContent = t.systemPrompt;
            
            document.getElementById('messageInput').placeholder = t.inputPlaceholder;
            document.getElementById('sendButton').textContent = t.send;
            mainLoadingIndicator.textContent = t.thinking;
            voiceLoadingIndicator.textContent = t.thinking;

            document.querySelector('.voice-dialog-header h3').textContent = t.voiceInput;
            document.getElementById('startListening').textContent = t.startListening;
            document.getElementById('stopListening').textContent = t.stopListening;
            document.getElementById('sendVoiceMessage').textContent = t.send;

            // stopSpeechButton.innerHTML = `üîá ${t.stopSpeech}`; // This button is removed
            stopBotResponseButtonDialog.textContent = t.stopBotResponseButtonText; // Update the new dialog button's text
            
            // Update the new toggle button in settings
            if (botResponsesStopped) {
                stopBotToggle.innerHTML = `üîä ${t.resumeBotResponses}`;
                stopBotToggle.classList.add('active');
            } else {
                stopBotToggle.innerHTML = `üîá ${t.stopBotResponses}`;
                stopBotToggle.classList.remove('active');
            }

            // Update mode toggle button text
            modeToggle.innerHTML = currentChatMode === 'text-to-text' ? `üí¨ ${t.textMode}` : `üé§ ${t.speechMode}`;

            updateWelcomeMessage(lang);
        }

        function updateWelcomeMessage(lang) {
            const messagesContainer = document.getElementById('messages');
            if (messagesContainer.children.length === 0 || 
                (messagesContainer.children.length === 1 && messagesContainer.children[0].textContent.includes("Welcome!"))) {
                messagesContainer.innerHTML = '';
                addMessage(translations[lang].welcome, false);
            }
        }

        function saveSettings() {
            const settings = {
                model: document.getElementById('modelSelect').value,
                systemPrompt: document.getElementById('systemPrompt').value,
                language: document.getElementById('languageSelect').value,
                chatMode: currentChatMode,
                botResponsesStopped: botResponsesStopped // Save the new state
            };
            localStorage.setItem('indicoreSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('indicoreSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('modelSelect').value = settings.model || 'sonar-pro';
                document.getElementById('systemPrompt').value = settings.systemPrompt || 'You are a helpful Multilingual AI assistant. Your name is Indicore-Ai. Provide accurate, detailed, and well-structured responses.';
                document.getElementById('languageSelect').value = settings.language || 'en';
                
                currentChatMode = settings.chatMode || 'text-to-text';
                botResponsesStopped = settings.botResponsesStopped || false; // Load the new state
                
                updateInterface(settings.language || 'en');
                applyChatMode(currentChatMode);
                
                const modelInfo = document.getElementById('modelInfo');
                modelInfo.textContent = modelDescriptions[settings.model || 'sonar-pro'];
            } else {
                addMessage(translations['en'].welcome, false);
                applyChatMode('text-to-text');
            }
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
            saveSettings();
        }

        // New function to toggle bot responses on/off
        function toggleBotResponses() {
            botResponsesStopped = !botResponsesStopped;
            const lang = document.getElementById('languageSelect').value;
            updateInterface(lang); // Update button text and class
            saveSettings();

            if (botResponsesStopped) {
                stopSpeech(); // Immediately stop any ongoing speech if bot is stopped
                if (currentChatMode === 'speech-to-speech' && azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition(); // Stop recognition as well
                }
                addMessage(`Bot responses are now ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}.`, false);
            } else {
                 addMessage(`Bot responses are now ${translations[lang].resumeBotResponses.includes('Resume') ? 'resumed' : '‡§™‡•Å‡§®‡§É ‡§∂‡•Å‡§∞‡•Ç'}.`, false);
                 // If in speech mode, and now resumed, restart listening
                 if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.startRecognition();
                 }
            }
        }


        function toggleMode() {
            if (currentChatMode === 'text-to-text') {
                currentChatMode = 'speech-to-speech';
            } else {
                currentChatMode = 'text-to-text';
                if (azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
                voiceDialog.style.display = 'none';
                stopSpeech(); // Stop any speech if user switches to text mode
            }
            saveSettings();
            applyChatMode(currentChatMode);
            updateInterface(document.getElementById('languageSelect').value);
        }

        function applyChatMode(mode) {
            if (mode === 'text-to-text') {
                chatContainer.classList.remove('speech-mode');
                chatContainer.classList.add('text-mode');
                messageInput.style.display = 'block';
                sendButton.style.display = 'flex';
                micButton.style.display = 'none';
                voiceDialog.style.display = 'none';
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                stopBotResponseButtonDialog.style.display = 'none'; // Hide the dialog stop button
            } else { // speech-to-speech
                chatContainer.classList.remove('text-mode');
                chatContainer.classList.add('speech-mode');
                messageInput.style.display = 'none';
                sendButton.style.display = 'none';
                micButton.style.display = 'flex';
                mainLoadingIndicator.classList.remove('active');
                voiceDialog.style.display = 'flex';
                // Only start recognition if bot responses are not stopped
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    const lang = document.getElementById('languageSelect').value;
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Listening disabled.`;
                }
            }
        }

        function addMessage(content, isUser) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;
            
            messageDiv.appendChild(contentDiv);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            const language = document.getElementById('languageSelect').value;
            const t = translations[language];
            
            if (!message) {
                alert(t.errorNoMessage);
                return;
            }

            // Immediately check if bot responses are stopped
            if (botResponsesStopped) {
                addMessage("Bot responses are currently stopped.", false);
                console.log("Bot responses are stopped. Not sending message to API.");
                messageInput.value = ''; // Clear input even if not sent
                // In speech mode, resume listening after user input if bot is stopped (no API call)
                if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.startRecognition();
                }
                return; // Stop the function here
            }

            if (currentChatMode === 'text-to-text') {
                addMessage(message, true);
            }
            updateQuestionCounter();
            messageInput.value = '';

            if (currentChatMode === 'text-to-text') {
                mainLoadingIndicator.classList.add('active');
            } else {
                voiceLoadingIndicator.classList.add('active');
                voiceDialog.style.display = 'flex';
                if (azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
            }
            sendButton.disabled = false; // Keep Send button enabled for new messages
            micButton.disabled = true; // Still disable mic during API call

            try {
                const model = document.getElementById('modelSelect').value;
                let systemPrompt = document.getElementById('systemPrompt').value.trim();
                
                if (language !== 'en') {
                    systemPrompt += ` Your response MUST be entirely in ${translations[language].languageName}. Do not use any other language. Ensure perfect grammar and natural flow in ${translations[language].languageName}.`;
                }

                console.log(`Sending prompt to Perplexity in ${language} with system prompt: "${systemPrompt}" and user message: "${message}"`);

                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_CONFIG.perplexity.key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            {
                                role: "system",
                                content: systemPrompt
                            },
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7,
                        top_p: 0.9,
                        search_domain_filter: ["perplexity.ai"],
                        return_images: false,
                        return_related_questions: false,
                        search_recency_filter: "month",
                        top_k: 0,
                        stream: false,
                        presence_penalty: 0,
                        frequency_penalty: 1
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    console.error('API Error from Perplexity:', response.status, errorData);
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const data = await response.json();
                
                let aiResponse = '';
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    aiResponse = data.choices[0].message.content;
                } else {
                    throw new Error('Invalid response format from Perplexity API');
                }
                
                console.log('Perplexity AI Raw Response Content:', aiResponse);
                console.log('Selected Language for TTS:', language);

                if (currentChatMode === 'text-to-text') {
                    addMessage(aiResponse, false);
                }

                if (currentChatMode === 'speech-to-speech' && aiResponse.trim().length > 0) {
                    speak(aiResponse, language);
                } else if (currentChatMode === 'speech-to-speech' && aiResponse.trim().length === 0) {
                    console.warn("Speech mode active, but AI returned empty response. Not speaking.");
                    if (voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                } else {
                    console.log("Text mode active, or no content to speak.");
                }

            } catch (error) {
                console.error('Error in sendMessage function:', error);
                let errorMessage = `Error: ${error.message}`;
                
                if (error.message.includes('401')) {
                    errorMessage = "Invalid API key. Please check your Perplexity API key in settings.";
                } else if (error.message.includes('429')) {
                    errorMessage = "Rate limit exceeded. Please wait a moment and try again.";
                } else if (error.message.includes('402')) {
                    errorMessage = "Insufficient credits. Please add credits to your Perplexity account.";
                } else if (error.message.includes('403')) {
                    errorMessage = "Access denied. Please verify your API key permissions.";
                }
                
                addMessage(errorMessage, false);
                if (currentChatMode === 'speech-to-speech') {
                    speak(errorMessage, language);
                }

            } finally {
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                sendButton.disabled = false;
                micButton.disabled = false;
                messageInput.focus();
                if (currentChatMode === 'speech-to-speech' && !isSpeaking && !azureSpeechRecognizer.isListening && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && currentChatMode === 'text-to-text') {
                sendMessage();
            }
        }

        // Voice input event listeners (modified for mode)
        micButton.addEventListener('click', function() {
            if (currentChatMode === 'speech-to-speech') {
                voiceDialog.style.display = 'flex';
                const lang = document.getElementById('languageSelect').value;
                document.getElementById('voiceStatus').textContent = translations[lang].voiceStatusStart;
                resetTranscription();
                // Only start recognition if bot responses are not stopped
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Listening disabled.`;
                }
            }
        });

        closeDialog.addEventListener('click', function() {
            voiceDialog.style.display = 'none';
            finalTranscriptText = '';
            resetTranscription();
            if (azureSpeechRecognizer.recognizer && azureSpeechRecognizer.isListening) {
                azureSpeechRecognizer.stopRecognition();
            }
            stopSpeech(); // Stop any ongoing speech if dialog is closed
        });

        startListening.addEventListener('click', function() {
            if (!botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            } else {
                const lang = document.getElementById('languageSelect').value;
                voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Cannot start listening.`;
            }
        });

        stopListening.addEventListener('click', function() {
            azureSpeechRecognizer.stopRecognition();
        });

        sendVoiceMessage.addEventListener('click', function() {
            const transcriptText = transcription.textContent.trim();
            const lang = document.getElementById('languageSelect').value;
            
            if (transcriptText && 
                transcriptText !== translations[lang].transcriptionPlaceholder) {
                messageInput.value = transcriptText;
                voiceDialog.style.display = 'none';
                sendMessage();
                
                finalTranscriptText = '';
                resetTranscription();
            }
        });

        // Event listener for the new "Stop Bot Response" button inside the dialog
        stopBotResponseButtonDialog.addEventListener('click', stopSpeech);

        document.getElementById('languageSelect').addEventListener('change', function() {
            updateInterface(this.value);
            saveSettings();
        });

        document.getElementById('modelSelect').addEventListener('change', function() {
            const modelInfo = document.getElementById('modelInfo');
            modelInfo.textContent = modelDescriptions[this.value];
            saveSettings();
        });

        document.addEventListener('DOMContentLoaded', async function() {
            loadSettings(); // Load all settings including botResponsesStopped
            loadQuestionStats();
            
            if (typeof SpeechSDK === 'undefined') {
                console.error('Azure Speech SDK not loaded');
                document.getElementById('voiceStatus').textContent = 'Azure Speech SDK not loaded. Voice input and output disabled.';
                micButton.disabled = true;
                // If SDK is not loaded, ensure speech-related buttons are disabled
                startListening.disabled = true;
                stopListening.disabled = true;
                sendVoiceMessage.disabled = true;
                stopBotResponseButtonDialog.disabled = true; // Disable this dialog button as well
                stopBotToggle.disabled = true; // Disable this toggle if speech isn't available
            } else {
                initializeAzureSynthesizer(); 
                micButton.disabled = false; 
            }
        });
    </script>
</body>
</html>
